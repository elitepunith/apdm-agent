from google.adk.tools import Tool
from urllib.parse import urlparse
import tldextract

# small sample blacklist â€” expand for production
KNOWN_MALWARE_DOMAINS = {
    "malwaredownload.net",
    "badexample[.]com".replace("[.]", "."),
    "evil-hosting.example",  # placeholder
}

def check_malware_link(url: str):
    try:
        parsed = urlparse(url)
        host = parsed.hostname or ""
        ext = tldextract.extract(host)
        domain = ".".join(part for part in (ext.domain, ext.suffix) if part)
        known = domain in KNOWN_MALWARE_DOMAINS
        return {"url": url, "domain": domain, "is_known_malware": known}
    except Exception as e:
        return {"url": url, "error": str(e), "is_known_malware": False}

malware_link_detector_tool = Tool(
    name="malware_link_detector",
    description="Check the domain of a URL against a small known-malware domain list.",
    func=check_malware_link,
    input_schema={
        "type":"object",
        "properties": {"url": {"type":"string"}},
        "required": ["url"]
    }
)
